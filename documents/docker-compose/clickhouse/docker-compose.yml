version: '3'
services:
  clickhouse:
    #image: clickhouse/clickhouse-server:21.3
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse
    privileged: true
    #restart: unless-stopped
    ports:
      - "8123:8123"
      - "9000:9000"
    environment:
      #- CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1
      - CLICKHOUSE_USER=admin
      - CLICKHOUSE_DEFAULT_PROFILE=default
      - CLICKHOUSE_PASSWORD=admin123
      #- CLICKHOUSE_DEFAULT_ACCESS: "1"
    # volumes:
    #   # 数据持久
    #   - ./data:/var/lib/clickhouse:rw
    #   - ./config/config.xml:/etc/clickhouse-server/config.xml:rw
    #   - ./config/users.xml:/etc/clickhouse-server/users.xml:rw
    #   # 运行日志
    #   - ./log:/var/log/clickhouse-server
    # ulimits:
    #   nofile:
    #     soft: 262144
    #     hard: 262144
  # clickhouse-init:
  #   image: clickhouse/clickhouse-client:latest
  #   depends_on:
  #     - clickhouse
  #   environment:
  #     - CLICKHOUSE_HOST=clickhouse
  #   command: >
  #     bash -c "echo 'CREATE USER IF NOT EXISTS root IDENTIFIED WITH plaintext_password BY 'root';' | clickhouse-client --multiquery --host clickhouse && 
  #              echo 'GRANT ALL PRIVILEGES ON *.* TO root;' | clickhouse-client --multiquery --host clickhouse"